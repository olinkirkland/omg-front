<?xml version="1.0"?>
<popups:BasePopup xmlns:fx="http://ns.adobe.com/mxml/2009"
                  xmlns:s="library://ns.adobe.com/flex/spark"
                  xmlns:components="components.*"
                  xmlns:popups="popups.*"
                  creationComplete="onCreationComplete(event)">
    
    <fx:Script>
        <![CDATA[
        import managers.LanguageManager;
    
        import mx.events.FlexEvent;
    
        private var valid: Boolean;
    
        private function onCreationComplete(event: FlexEvent): void
        {
            // Text
            titleLabel.text = LanguageManager.getText("labelVerifyEmailTitle");
            descriptionLabel.text = LanguageManager.getText("labelVerifyEmailBody").replace("%EMAIL%", payload as String);
            inputVerifyCode.preview = LanguageManager.getText("inputVerifyCodePreview");
            labelResendVerifyCode.text = LanguageManager.getText("labelResendVerifyCode");
        
            buttonResendVerifyCode.text = LanguageManager.getText("buttonResendVerifyCode");
            buttonSubmitVerifyCode.text = LanguageManager.getText("buttonSubmitVerifyCode");
        
            // Add Listeners
            buttonResendVerifyCode.addEventListener(MouseEvent.CLICK, onResendVerifyCode);
            buttonSubmitVerifyCode.addEventListener(MouseEvent.CLICK, onSubmitVerifyCode);
        
            inputVerifyCode.addEventListener(KeyboardEvent.KEY_DOWN, updateSubmitButton);
            inputVerifyCode.addEventListener(KeyboardEvent.KEY_UP, updateSubmitButton);
        
            updateSubmitButton(null);
        }
    
        override public function dispose(): void
        {
            super.dispose();
        
            // Remove listeners
            buttonResendVerifyCode.removeEventListener(MouseEvent.CLICK, onResendVerifyCode);
            buttonSubmitVerifyCode.removeEventListener(MouseEvent.CLICK, onSubmitVerifyCode);
        
            inputVerifyCode.removeEventListener(KeyboardEvent.KEY_DOWN, updateSubmitButton);
            inputVerifyCode.removeEventListener(KeyboardEvent.KEY_UP, updateSubmitButton);
        }
    
        private function onResendVerifyCode(event: MouseEvent): void
        {
            signalManager.dispatch({
                action: "resendVerifyCode",
                args:   {
                    email: payload as String
                }
            });
        }
    
        private function onSubmitVerifyCode(event: MouseEvent): void
        {
            signalManager.dispatch({
                action: "submitVerifyCode",
                args:   {
                    email:      payload as String,
                    verifyCode: inputVerifyCode.text
                }
            });
        
            buttonResendVerifyCode.style = "disabled";
            buttonSubmitVerifyCode.style = "disabled";
        }
    
        private function updateSubmitButton(event: Event): void
        {
            callLater(function (): void
            {
                valid = inputVerifyCode.text.length != 0;
                buttonSubmitVerifyCode.style = valid ? "action" : "disabled";
            });
        }
        ]]>
    </fx:Script>
    
    <s:Panel skinClass="skins.PanelSkin"
             width="600"
             minHeight="60"
             maxHeight="600">
        
        <s:BitmapImage id="bitmapImage"
                       smooth="true"
                       smoothingQuality="high" />
        
        <s:VGroup id="content"
                  width="100%"
                  height="100%"
                  gap="0">
            <s:Panel skinClass="skins.NestedPanelSkin"
                     width="100%">
                <s:HGroup width="100%"
                          gap="10"
                          padding="5">
                    <s:HGroup width="100%"
                              padding="10">
                        <s:Label id="titleLabel"
                                 fontSize="20"
                                 fontWeight="bold"
                                 width="100%" />
                    </s:HGroup>
                </s:HGroup>
            </s:Panel>
            <s:VGroup width="100%"
                      height="100%"
                      padding="10">
                <s:Label id="descriptionLabel"
                         width="100%"
                         paddingLeft="20"
                         paddingRight="20" />
                <s:Spacer height="20" />
                <s:HGroup width="100%"
                          horizontalAlign="center">
                    <components:InputComponent id="inputVerifyCode"
                                               width="350" />
                </s:HGroup>
                <s:Spacer height="20" />
            </s:VGroup>
            <s:Panel width="100%"
                     height="60"
                     skinClass="skins.NestedPanelSkin">
                <s:HGroup width="100%"
                          height="100%"
                          verticalAlign="middle"
                          verticalCenter="0"
                          padding="15">
                    <components:ButtonComponent id="buttonResendVerifyCode"
                                                style="normal" />
                    <s:Label id="labelResendVerifyCode"
                             width="100%" />
                    <s:Spacer width="100%" />
                    <components:ButtonComponent id="buttonSubmitVerifyCode"
                                                style="action" />
                </s:HGroup>
            
            </s:Panel>
        </s:VGroup>
    </s:Panel>

</popups:BasePopup>